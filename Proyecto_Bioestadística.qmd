---
title: "Untitled"
format: html
editor: visual
---

```{r}
library(haven)
library(writexl)
library(lubridate)
library(dplyr)
library(ggplot2)
library(sf)
library(ggplot2)
library(lubridate)
library(corrplot)
```

```{r}
#Importando datos
BD1_sav <- read_sav("Registro_casos 1.sav")
write_xlsx(BD1_sav, "BD1.xlsx")
BD2_sav <- read_sav("Registro_casos 2.sav")
write_xlsx(BD2_sav, "BD2.xlsx")
#Quitando variables diferentes (no en común)
columnas_tabla1 <- colnames(BD1_sav)
columnas_tabla2 <- colnames(BD2_sav)
##Identificar columnas diferentes
columnas_diferentes <- setdiff(union(columnas_tabla1, columnas_tabla2), intersect(columnas_tabla1, columnas_tabla2))
##Eliminando las columnas que son diferentes entre base de datos 
BD1 <- BD1_sav[, !(names(BD1_sav) %in% columnas_diferentes)]
BD2 <- BD2_sav[, !(names(BD2_sav) %in% columnas_diferentes)]
#Filtrando datos por solo violencia psicológica
##Filtro 2: sexo de victima -> mujeres
BD1<-BD1[BD1$SEXO_VICTIMA==0,]
BD2<-BD2[BD2$SEXO_VICTIMA==0,]
#Jundanto base de datos en una tabla 
BD1 <- as.data.frame(lapply(BD1,as.character))
BD2 <- as.data.frame(lapply(BD2,as.character))
BD_2023 <- rbind(BD1,BD2)#mujeres que sufrieron de violencia
#Agregando semanas epidemiodológicas
BD_2023<- BD_2023 %>%
  mutate(
    semana_epidemiologica = epiweek(FECHA_INGRESO),
    año_epidemiologico = ifelse(month(FECHA_INGRESO) == 12 & epiweek(FECHA_INGRESO) == 1, year(FECHA_INGRESO) + 1, year(FECHA_INGRESO))
  )

BD_VSP_2023 <- data.frame(BD_2023%>%select(1,2,19,20,21,27,28,29,30,33,34,35,37,38,44,57,58,59,60,61,63,64,65,66,69,70,126,127,129,131,153,156,157,160,161,162,163,164,165))
#Convirtiendo los tipos de datos a numéricos menos el CEM y fecha de ingreso
BD_VSP_2023 <- BD_VSP_2023 %>% mutate(across(-c(1, 3), as.numeric))
#agregando variable mayor de edad
#menorde edad[1]
#mayor de edad [0]
BD_VSP_2023$MENOR_DE_EDAD <- ifelse(BD_VSP_2023$EDAD_VICTIMA < 18, 1, 0)
names(BD_VSP_2023)

```
